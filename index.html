<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>數位學習實驗班 - 整合系統</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

    <link rel="stylesheet" href="css/global.css">
    
    <link rel="stylesheet" href="modules/contact/contact.css">
    <link rel="stylesheet" href="modules/forms/forms.css">
    <link rel="stylesheet" href="modules/discuss/discuss.css">
    <link rel="stylesheet" href="modules/profile/profile.css">
    <link rel="stylesheet" href="modules/admin/admin.css"> </head>
<body class="bg-light">

    <div id="welcomeOverlay" class="d-none">
        <div class="welcome-content">
            <div class="icon-container"><i class="fas fa-graduation-cap welcome-icon"></i></div>
            <h1 class="welcome-text">歡迎使用</h1>
            <h2 class="welcome-subtext">數位學習實驗班整合系統</h2>
        </div>
    </div>

    <div class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index: 1100;">
        <div id="systemToast" class="toast align-items-center text-white border-0" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="d-flex"><div class="toast-body" id="toastMessage"></div><button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button></div>
        </div>
    </div>

    <div id="loginView" class="container d-flex justify-content-center align-items-center min-vh-100">
        <div class="card shadow-lg border-0" style="width: 100%; max-width: 400px; border-radius: 12px;">
            <div class="card-body p-5 text-center">
                <div class="mb-4 text-primary"><i class="fas fa-graduation-cap fa-4x"></i></div>
                <h2 class="fw-bold text-dark">數位實驗班</h2>
                <p class="text-muted mb-4">Digital Learning Portal</p>
                <div class="form-floating mb-3"><input type="text" class="form-control" id="username" placeholder="學號"><label>帳號</label></div>
                <div class="form-floating mb-4"><input type="password" class="form-control" id="password" placeholder="密碼"><label>密碼</label></div>
                <button class="btn btn-primary w-100 py-2 fs-5 mb-3 rounded-pill" id="loginBtn">登入系統</button>
                <div id="msgBox" class="text-danger small" style="min-height: 20px;"></div>
                <div class="d-flex justify-content-between mt-4 small text-secondary">
                    <a href="#" id="guestBtn" class="text-decoration-none text-secondary">訪客試用</a><span>|</span><a href="#" id="devBtn" class="text-decoration-none text-secondary">開發者管理</a>
                </div>
            </div>
        </div>
    </div>

    <div id="dashboardView" class="d-none">
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm mb-4">
            <div class="container">
                <a class="navbar-brand fw-bold" href="#"><i class="fas fa-graduation-cap me-2"></i>數位實驗班</a>
                <div class="d-flex align-items-center text-white">
                    <span id="welcomeText" class="me-3 d-none d-md-block">同學你好</span>
                    <button class="btn btn-outline-light btn-sm rounded-pill me-2" onclick="enterProfile()"><i class="fas fa-user-circle me-1"></i> 個人頁面</button>
                    <button class="btn btn-outline-light btn-sm rounded-pill" id="logoutBtn">登出</button>
                </div>
            </div>
        </nav>
        <div class="container">
            <div class="row row-cols-1 row-cols-md-2 row-cols-lg-4 g-4">
                
                <div class="col d-none" id="adminDashboardCard">
                    <div class="card h-100 border-0 shadow-sm hover-card admin-stats-card" onclick="enterAdminPanel()">
                        <div class="card-body text-center py-5">
                            <div class="icon-box bg-dark text-white mb-3 mx-auto rounded-circle d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;">
                                <i class="fas fa-users-cog fa-2x"></i>
                            </div>
                            <h5 class="card-title fw-bold text-dark">後台管理</h5>
                            <div class="mt-2 text-muted small">
                                <div>總人數: <span id="adminTotalUsers" class="fw-bold text-primary">-</span></div>
                                <div>線上人數: <span id="adminOnlineUsers" class="fw-bold text-success">-</span></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col"><div class="card h-100 border-0 shadow-sm hover-card" onclick="alert('功能開發中')"><div class="card-body text-center py-5"><div class="icon-box bg-info text-white mb-3 mx-auto rounded-circle d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;"><i class="fas fa-folder-open fa-2x"></i></div><h5 class="card-title fw-bold">課程資料夾</h5></div></div></div>
                <div class="col"><div class="card h-100 border-0 shadow-sm hover-card" onclick="enterFormSystem()"><div class="card-body text-center py-5"><div class="icon-box bg-success text-white mb-3 mx-auto rounded-circle d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;"><i class="fas fa-poll-h fa-2x"></i></div><h5 class="card-title fw-bold">Google 表單</h5><p class="card-text text-muted small">問卷 / 測驗 / 統計</p></div></div></div>
                <div class="col"><div class="card h-100 border-0 shadow-sm hover-card" onclick="enterCommBook()"><div class="card-body text-center py-5"><div class="icon-box bg-warning text-white mb-3 mx-auto rounded-circle d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;"><i class="fas fa-book-open fa-2x"></i></div><h5 class="card-title fw-bold">聯絡簿</h5><p class="card-text text-muted small">作業 / 考試 / 事項</p></div></div></div>
                <div class="col"><div class="card h-100 border-0 shadow-sm hover-card" onclick="enterDiscuss()"><div class="card-body text-center py-5"><div class="icon-box bg-secondary text-white mb-3 mx-auto rounded-circle d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;"><i class="fas fa-comments fa-2x"></i></div><h5 class="card-title fw-bold">討論區</h5></div></div></div>
            </div>
        </div>
    </div>

    <div id="adminManageView" class="d-none min-vh-100 bg-light">
        <nav class="navbar navbar-light bg-white shadow-sm px-3 mb-4 sticky-top">
            <div class="container">
                <div class="d-flex align-items-center">
                    <button class="btn btn-icon me-3" onclick="backToDashboard()"><i class="fas fa-arrow-left"></i></button>
                    <h5 class="mb-0 fw-bold text-dark"><i class="fas fa-users-cog me-2"></i>使用者管理</h5>
                </div>
                <div class="d-flex gap-3 text-secondary small">
                    <span>總人數: <b id="adminManageTotal" class="text-dark">-</b></span>
                    <span>線上: <b id="adminManageOnline" class="text-success">-</b></span>
                </div>
            </div>
        </nav>
        <div class="container pb-5">
            <div class="user-table-container">
                <div class="table-responsive">
                    <table class="table table-hover mb-0 align-middle">
                        <thead>
                            <tr>
                                <th style="width: 50px;">狀態</th>
                                <th>學號</th>
                                <th>姓名</th>
                                <th>班級座號</th>
                                <th>暱稱</th>
                                <th>權限</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="userTableBody">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="adminEditUserModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title fw-bold">修改使用者資料</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">學號 (帳號)</label>
                        <input type="text" class="form-control bg-light" id="editTargetUsername" readonly>
                    </div>
                    <div class="row g-2 mb-3">
                        <div class="col-6">
                            <label class="form-label">真實姓名</label>
                            <input type="text" class="form-control" id="editTargetRealName">
                        </div>
                        <div class="col-6">
                            <label class="form-label">班級座號</label>
                            <input type="text" class="form-control" id="editTargetClassSeat" placeholder="例: 101-05">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">顯示暱稱</label>
                        <input type="text" class="form-control" id="editTargetNickname">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">權限角色</label>
                        <select class="form-select" id="editTargetRole">
                            <option value="student">學生</option>
                            <option value="admin">管理者</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" onclick="saveAdminUserChanges()">儲存變更</button>
                </div>
            </div>
        </div>
    </div>

    <div id="profileView" class="d-none min-vh-100 bg-light">
        <nav class="navbar navbar-light bg-white shadow-sm px-3 mb-4">
            <div class="container"><div class="d-flex align-items-center"><button class="btn btn-icon me-3" onclick="backToDashboard()"><i class="fas fa-arrow-left"></i></button><h5 class="mb-0 fw-bold text-primary"><i class="fas fa-id-card me-2"></i>個人資料</h5></div></div>
        </nav>
        <div class="container pb-5" style="max-width: 600px;">
            <div class="card google-card border-0 shadow-sm"><div class="card-body p-4">
                <div class="text-center mb-4"><div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center mx-auto mb-3" style="width: 80px; height: 80px; font-size: 2rem;"><i class="fas fa-user"></i></div><h4 class="fw-bold" id="profileDisplayId">學號</h4></div>
                <div class="row g-3">
                    <div class="col-md-6"><label class="form-label fw-bold">學號 (不可修改)</label><input type="text" class="form-control bg-light" id="profileId" readonly></div>
                    <div class="col-md-6"><label class="form-label fw-bold">班級座號</label><input type="text" class="form-control" id="profileClassSeat" placeholder="例如：101-05"></div>
                    <div class="col-md-6"><label class="form-label fw-bold">真實姓名</label><input type="text" class="form-control" id="profileRealName" placeholder="輸入姓名"></div>
                    <div class="col-md-6"><label class="form-label fw-bold">顯示暱稱</label><input type="text" class="form-control" id="profileNickname" placeholder="輸入暱稱"></div>
                    <div class="col-12"><label class="form-label fw-bold">自我介紹 (選填)</label><textarea class="form-control" id="profileBio" rows="3" placeholder="寫點什麼..."></textarea></div>
                </div>
                <div class="d-flex justify-content-end mt-4"><button class="btn btn-primary px-4 rounded-pill" onclick="saveProfile()"><i class="fas fa-save me-2"></i>儲存變更</button></div>
            </div></div>
        </div>
    </div>

    <div id="commBookView" class="d-none min-vh-100 bg-light">
        <nav class="navbar navbar-light bg-white shadow-sm px-3 mb-4 sticky-top">
            <div class="container"><div class="d-flex align-items-center"><button class="btn btn-icon me-3" onclick="backToDashboard()"><i class="fas fa-arrow-left"></i></button><h5 class="mb-0 fw-bold text-warning"><i class="fas fa-book-open me-2"></i>聯絡簿</h5></div></div>
        </nav>
        <div class="container pb-5" style="max-width: 850px;">
            <div id="commBookAdminPanel" class="card shadow-sm border-0 mb-5 d-none">
                <div class="card-header bg-warning text-white fw-bold"><i class="fas fa-edit me-2"></i>編輯聯絡簿</div>
                <div class="card-body">
                    <div class="mb-3"><label class="form-label fw-bold">日期</label><input type="date" id="commDate" class="form-control w-auto"></div>
                    <div class="row g-3">
                        <div class="col-md-4"><div class="p-3 bg-light rounded border h-100"><h6 class="fw-bold text-primary mb-3">📘 作業</h6><div id="homeworkInputs"></div><button class="btn btn-sm btn-outline-primary mt-2 w-100" onclick="addCommInput('homework')"><i class="fas fa-plus"></i> 新增 (Enter)</button></div></div>
                        <div class="col-md-4"><div class="p-3 bg-light rounded border h-100"><h6 class="fw-bold text-danger mb-3">📝 考試</h6><div id="examInputs"></div><button class="btn btn-sm btn-outline-danger mt-2 w-100" onclick="addCommInput('exam')"><i class="fas fa-plus"></i> 新增 (Enter)</button></div></div>
                        <div class="col-md-4"><div class="p-3 bg-light rounded border h-100"><h6 class="fw-bold text-success mb-3">📌 其他事項</h6><div id="otherInputs"></div><button class="btn btn-sm btn-outline-success mt-2 w-100" onclick="addCommInput('other')"><i class="fas fa-plus"></i> 新增 (Enter)</button></div></div>
                    </div>
                    <div class="d-flex justify-content-end mt-4"><button class="btn btn-warning text-white fw-bold px-4 rounded-pill" onclick="addCommBookEntry()">發布更新</button></div>
                </div>
            </div>
            <h5 class="fw-bold text-secondary mb-4 ps-2 border-start border-4 border-warning">每日待辦清單</h5>
            <div id="commBookList" class="d-flex flex-column gap-4"></div>
        </div>
    </div>

    <div id="formListView" class="d-none min-vh-100 bg-light">
        <nav class="navbar navbar-light bg-white shadow-sm px-3 mb-4"><div class="container d-flex justify-content-between"><div class="d-flex align-items-center"><button class="btn btn-icon me-3" onclick="backToDashboard()"><i class="fas fa-arrow-left"></i></button><h5 class="mb-0 fw-bold text-secondary">所有表單</h5></div><button id="createFormBtn" class="btn btn-primary d-none rounded-pill px-4" onclick="enterFormBuilder()"><i class="fas fa-plus me-2"></i>建立新表單</button></div></nav>
        <div class="container"><div id="formsContainer" class="row g-4"></div></div>
    </div>
    <div id="formBuilderView" class="d-none min-vh-100" style="background-color: #f0ebf8;"></div>
    <div id="formResponderView" class="d-none min-vh-100 theme-bg"></div>
    <div id="formResultView" class="d-none min-vh-100 bg-light"></div>
    <div id="discussView" class="d-none vh-100 flex-column bg-light"></div>
    
    <div class="modal fade" id="devModal" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header bg-dark text-white"><h5 class="modal-title">開發者後台</h5><button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button></div><div class="modal-body"><h6 class="fw-bold">使用者列表</h6><ul id="userList" class="list-group mb-3" style="max-height: 200px; overflow-y: auto;"></ul><hr><h6 class="fw-bold">新增使用者</h6><div class="row g-2"><div class="col-4"><input type="text" class="form-control" id="newUsername" placeholder="帳號"></div><div class="col-4"><input type="text" class="form-control" id="newPassword" placeholder="密碼"></div><div class="col-4"><select class="form-select" id="newRole"><option value="student">學生</option><option value="admin">管理者</option></select></div><div class="col-12 mt-2"><button class="btn btn-primary w-100" onclick="addNewUser()">新增</button></div></div></div></div></div></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/main.js"></script>
    <script src="modules/auth/auth.js"></script>
    <script src="modules/dashboard/dashboard.js"></script>
    <script src="modules/contact/contact.js"></script>
    <script src="modules/forms/forms.js"></script>
    <script src="modules/discuss/discuss.js"></script>
    <script src="modules/profile/profile.js"></script>
    <script src="modules/admin/admin.js"></script> </body>
</html>