<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>數位學習實驗班 - 整合系統</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-light">

    <div id="loginView" class="container d-flex justify-content-center align-items-center min-vh-100">
        <div class="card shadow-lg border-0" style="width: 100%; max-width: 400px; border-radius: 12px;">
            <div class="card-body p-5 text-center">
                <div class="mb-4 text-primary"><i class="fas fa-graduation-cap fa-4x"></i></div>
                <h2 class="fw-bold text-dark">數位實驗班</h2>
                <p class="text-muted mb-4">Digital Learning Portal</p>
                <div class="form-floating mb-3">
                    <input type="text" class="form-control" id="username" placeholder="學號">
                    <label>帳號 / 學號</label>
                </div>
                <div class="form-floating mb-4">
                    <input type="password" class="form-control" id="password" placeholder="密碼">
                    <label>密碼</label>
                </div>
                <button class="btn btn-primary w-100 py-2 fs-5 mb-3 rounded-pill" id="loginBtn">登入系統</button>
                <div id="msgBox" class="text-danger small" style="min-height: 20px;"></div>
                <div class="d-flex justify-content-between mt-4 small text-secondary">
                    <a href="#" id="guestBtn" class="text-decoration-none text-secondary">訪客試用</a>
                    <span>|</span>
                    <a href="#" id="devBtn" class="text-decoration-none text-secondary">開發者管理</a>
                </div>
            </div>
        </div>
    </div>

    <div id="dashboardView" class="d-none">
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm mb-4">
            <div class="container">
                <a class="navbar-brand fw-bold" href="#"><i class="fas fa-graduation-cap me-2"></i>數位實驗班</a>
                <div class="d-flex align-items-center text-white">
                    <span id="welcomeText" class="me-3 d-none d-md-block">同學你好</span>
                    <button class="btn btn-outline-light btn-sm rounded-pill" id="logoutBtn">登出</button>
                </div>
            </div>
        </nav>
        <div class="container">
            <div class="row row-cols-1 row-cols-md-2 row-cols-lg-4 g-4">
                <div class="col"><div class="card h-100 border-0 shadow-sm hover-card" onclick="alert('功能開發中')"><div class="card-body text-center py-5"><div class="icon-box bg-info text-white mb-3 mx-auto rounded-circle d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;"><i class="fas fa-folder-open fa-2x"></i></div><h5 class="card-title fw-bold">課程資料夾</h5></div></div></div>
                <div class="col"><div class="card h-100 border-0 shadow-sm hover-card" onclick="enterFormSystem()"><div class="card-body text-center py-5"><div class="icon-box bg-success text-white mb-3 mx-auto rounded-circle d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;"><i class="fas fa-poll-h fa-2x"></i></div><h5 class="card-title fw-bold">Google 表單系統</h5><p class="card-text text-muted small">問卷 / 測驗 / 統計</p></div></div></div>
                <div class="col"><div class="card h-100 border-0 shadow-sm hover-card" onclick="alert('功能開發中')"><div class="card-body text-center py-5"><div class="icon-box bg-danger text-white mb-3 mx-auto rounded-circle d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;"><i class="fas fa-file-upload fa-2x"></i></div><h5 class="card-title fw-bold">作業繳交</h5></div></div></div>
                <div class="col"><div class="card h-100 border-0 shadow-sm hover-card" onclick="enterDiscuss()"><div class="card-body text-center py-5"><div class="icon-box bg-warning text-white mb-3 mx-auto rounded-circle d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;"><i class="fas fa-comments fa-2x"></i></div><h5 class="card-title fw-bold">討論區</h5></div></div></div>
            </div>
        </div>
    </div>

    <div id="formListView" class="d-none min-vh-100 bg-light">
        <nav class="navbar navbar-light bg-white shadow-sm px-3 mb-4">
            <div class="container d-flex justify-content-between">
                <div class="d-flex align-items-center">
                    <button class="btn btn-icon me-3" onclick="backToDashboard()"><i class="fas fa-arrow-left"></i></button>
                    <h5 class="mb-0 fw-bold text-secondary">所有表單</h5>
                </div>
                <button id="createFormBtn" class="btn btn-primary d-none rounded-pill px-4" onclick="enterFormBuilder()">
                    <i class="fas fa-plus me-2"></i>建立新表單
                </button>
            </div>
        </nav>
        <div class="container"><div id="formsContainer" class="row g-4"></div></div>
    </div>

    <div id="formBuilderView" class="d-none min-vh-100" style="background-color: #f0ebf8;">
        <nav class="navbar navbar-light bg-white px-3 border-bottom sticky-top" style="z-index: 1030;">
            <div class="container-fluid d-flex justify-content-between">
                <div class="d-flex align-items-center">
                    <button class="btn btn-icon me-3" onclick="enterFormSystem()"><i class="fas fa-arrow-left" style="color:#5f6368;"></i></button>
                    <span class="navbar-text text-dark fw-bold" id="headerFormTitle">未命名表單</span>
                </div>
                <div class="d-flex gap-2">
                    <button class="btn btn-light rounded-circle p-2" onclick="toggleFormSettings()"><i class="fas fa-cog"></i></button>
                    <button class="btn btn-primary px-4 rounded-pill fw-bold" onclick="saveNewForm()">發布</button>
                </div>
            </div>
            <div class="container-fluid justify-content-center mt-2">
                <div class="google-tabs">
                    <div class="tab active">問題</div>
                    <div class="tab" onclick="alert('請先發布表單')">回覆</div>
                    <div class="tab" onclick="toggleFormSettings()">設定</div>
                </div>
            </div>
        </nav>

        <div class="container mt-4 pb-5" style="max-width: 770px;">
            <div id="formSettingsPanel" class="card google-card mb-3 d-none">
                <div class="card-header bg-white border-bottom-0 pt-3 pb-0"><h5 class="fw-bold">設定</h5></div>
                <div class="card-body">
                    <div class="form-check form-switch mb-3"><input class="form-check-input" type="checkbox" id="setLimitOne"><label>僅限填寫一次</label></div>
                    <div class="form-check form-switch mb-3"><input class="form-check-input" type="checkbox" id="setAllowEdit"><label>允許提交後編輯</label></div>
                    <div class="form-check form-switch mb-3"><input class="form-check-input" type="checkbox" id="setCollectEmail"><label>收集 Email</label></div>
                    <div class="row g-2 mb-3"><div class="col-6"><label class="small text-muted">開始</label><input type="datetime-local" class="form-control" id="setStartTime"></div><div class="col-6"><label class="small text-muted">結束</label><input type="datetime-local" class="form-control" id="setEndTime"></div></div>
                </div>
            </div>

            <div class="card google-card border-top-purple mb-3">
                <div class="card-body p-4">
                    <input type="text" id="buildTitle" class="form-control form-control-lg border-0 fs-1 fw-bold mb-2 title-input" placeholder="未命名表單" value="未命名表單" oninput="document.getElementById('headerFormTitle').innerText=this.value">
                    <textarea id="buildDesc" class="form-control border-0 desc-input" placeholder="表單說明" rows="1"></textarea>
                </div>
            </div>
            
            <div id="questionsContainer"></div>
        </div>

        <div class="floating-sidebar">
            <button class="btn btn-light shadow-sm rounded-circle mb-3 p-2" title="新增問題" onclick="addQuestionCard('radio')"><i class="fas fa-plus-circle fa-lg text-secondary"></i></button>
            <button class="btn btn-light shadow-sm rounded-circle mb-3 p-2" title="新增文字說明" onclick="addQuestionCard('text')"><i class="fas fa-font fa-lg text-secondary"></i></button>
            <button class="btn btn-light shadow-sm rounded-circle mb-3 p-2" title="新增區段" onclick="addSectionBreak()"><i class="fas fa-grip-lines fa-lg text-secondary"></i></button>
        </div>
    </div>

    <div id="formResponderView" class="d-none min-vh-100" style="background-color: #f0ebf8;">
        <nav class="navbar navbar-light bg-white shadow-sm px-3 mb-4 sticky-top"><div class="d-flex align-items-center"><button class="btn btn-icon me-3" onclick="enterFormSystem()"><i class="fas fa-times"></i></button><h5 class="mb-0 fw-bold">填寫表單</h5></div></nav>
        <div class="container pb-5" style="max-width: 640px;"><div class="card google-card border-top-purple mb-3"><div class="card-body p-4"><h1 id="viewFormTitle" class="fw-bold mb-3 fs-2"></h1><p id="viewFormDesc" class="text-muted"></p><div class="small text-danger border-top pt-2 mt-3">* 為必填項目</div></div></div><div class="progress mb-4" style="height: 4px;"><div id="formProgressBar" class="progress-bar bg-purple" role="progressbar" style="width: 0%"></div></div><form id="responderForm"><div id="viewQuestionsArea"></div></form><div class="d-flex justify-content-between mt-4"><button class="btn btn-outline-secondary px-4 d-none rounded-3" id="prevSectionBtn" onclick="navSection(-1)">返回</button><button class="btn btn-primary px-4 rounded-3" id="nextSectionBtn" onclick="navSection(1)">繼續</button><button class="btn btn-primary px-4 d-none rounded-3" id="submitFormBtn" onclick="submitFormResponse()">提交</button></div></div>
    </div>

    <div id="formResultView" class="d-none min-vh-100 bg-light">
        <nav class="navbar navbar-light bg-white shadow-sm px-3 mb-4 sticky-top"><div class="d-flex align-items-center"><button class="btn btn-icon me-3" onclick="enterFormSystem()"><i class="fas fa-arrow-left"></i></button><h5 class="mb-0 fw-bold">回應分析</h5></div><div class="btn-group"><button class="btn btn-outline-primary active" id="btnViewSummary" onclick="switchResultTab('summary')">摘要</button><button class="btn btn-outline-primary" id="btnViewIndividual" onclick="switchResultTab('individual')">個別</button><button class="btn btn-success" onclick="exportToExcel()">匯出</button></div></nav>
        <div class="container pb-5" style="max-width: 900px;"><h3 id="resultTitle" class="fw-bold mb-4 text-center"></h3><div id="resultSummaryArea"><div id="chartsContainer" class="row g-4"></div></div><div id="resultIndividualArea" class="d-none"><div class="card google-card mb-3"><div class="card-body d-flex justify-content-between align-items-center"><button class="btn btn-icon" onclick="navIndividual(-1)"><i class="fas fa-chevron-left"></i></button><span class="fw-bold">第 <span id="indivIndex">1</span> 筆，共 <span id="indivTotal">0</span> 筆</span><button class="btn btn-icon" onclick="navIndividual(1)"><i class="fas fa-chevron-right"></i></button></div></div><div id="individualContent" class="card google-card p-4"></div></div></div>
    </div>

    <div id="discussView" class="d-none vh-100 flex-column bg-light">
        <nav class="navbar navbar-light bg-white shadow-sm px-3 flex-shrink-0"><div class="d-flex align-items-center"><button class="btn btn-icon me-3" onclick="backToDashboard()"><i class="fas fa-arrow-left"></i></button><h5 class="mb-0 fw-bold">班級討論區</h5></div><button class="btn btn-sm btn-light" onclick="loadMessages()"><i class="fas fa-sync-alt"></i></button></nav>
        <div id="chatContainer" class="flex-grow-1 p-3 overflow-auto"></div>
        <div class="p-3 bg-white border-top flex-shrink-0"><div class="input-group"><input type="text" id="msgInput" class="form-control" placeholder="輸入留言..."><button class="btn btn-primary" onclick="sendMessage()">傳送</button></div></div>
    </div>

    <div class="modal fade" id="devModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-dark text-white"><h5 class="modal-title">開發者後台</h5><button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <h6 class="fw-bold">使用者列表</h6>
                    <ul id="userList" class="list-group mb-3" style="max-height: 200px; overflow-y: auto;"></ul>
                    <hr>
                    <h6 class="fw-bold">新增使用者</h6>
                    <div class="row g-2">
                        <div class="col-4"><input type="text" class="form-control" id="newUsername" placeholder="帳號"></div>
                        <div class="col-4"><input type="text" class="form-control" id="newPassword" placeholder="密碼"></div>
                        <div class="col-4">
                            <select class="form-select" id="newRole">
                                <option value="student">學生</option>
                                <option value="admin">老師/管理</option>
                            </select>
                        </div>
                        <div class="col-12 mt-2"><button class="btn btn-primary w-100" onclick="addNewUser()">新增</button></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="script.js"></script>
</body>
</html>